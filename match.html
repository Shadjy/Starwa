<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Vacature Matching Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- CSS uit map css -->
  <link rel="stylesheet" href="/css/global.css" />
  <link rel="stylesheet" href="/css/match.css" />
</head>
<body>
  <div class="wrap">
    <h1>Matching algoritme – vacatures</h1>
    <div class="grid">
      <!-- Sticky filters links -->
      <div class="panel sidebar">
        <form id="matchForm">
          <label class="label-row">
            <span>Functie</span>
            <button type="button" class="info-btn" data-info="functie" aria-label="Info functie">
              <svg viewBox="0 0 24 24" class="info-icon" aria-hidden="true">
                <circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/>
                <circle cx="12" cy="7.5" r="1.2" fill="currentColor"/>
                <rect x="11" y="10" width="2" height="7" rx="1" fill="currentColor"/>
              </svg>
            </button>
          </label>
          <select id="functie">
            <option>Data Analist</option><option>Developer</option><option>Project Manager</option>
          </select>

          <label class="label-row">
            <span>Locatie</span>
            <button type="button" class="info-btn" data-info="locatie" aria-label="Info locatie">
              <svg viewBox="0 0 24 24" class="info-icon"><circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/><circle cx="12" cy="7.5" r="1.2" fill="currentColor"/><rect x="11" y="10" width="2" height="7" rx="1" fill="currentColor"/></svg>
            </button>
          </label>
          <select id="locatie">
            <option>Utrecht</option><option>Amsterdam</option><option>Rotterdam</option>
          </select>

          <label class="label-row">
            <span>Uren per week</span>
            <button type="button" class="info-btn" data-info="uren" aria-label="Info uren">
              <svg viewBox="0 0 24 24" class="info-icon"><circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/><circle cx="12" cy="7.5" r="1.2" fill="currentColor"/><rect x="11" y="10" width="2" height="7" rx="1" fill="currentColor"/></svg>
            </button>
          </label>
          <select id="uren">
            <option>12</option><option>16</option><option>22</option>
            <option>24</option><option>32</option><option>36</option><option selected>40</option>
          </select>

          <label class="label-row">
            <span>Sector</span>
            <button type="button" class="info-btn" data-info="sector" aria-label="Info sector">
              <svg viewBox="0 0 24 24" class="info-icon"><circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/><circle cx="12" cy="7.5" r="1.2" fill="currentColor"/><rect x="11" y="10" width="2" height="7" rx="1" fill="currentColor"/></svg>
            </button>
          </label>
          <select id="sector">
            <option>Alle</option><option>Zorg & Analytics</option><option>FinTech</option><option>Logistiek</option><option>HealthTech</option><option>Finance</option><option>Transport</option><option>Duurzaamheid</option>
          </select>

          <label class="label-row">
            <span>Contracttype</span>
            <button type="button" class="info-btn" data-info="contract" aria-label="Info contracttype">
              <svg viewBox="0 0 24 24" class="info-icon"><circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/><circle cx="12" cy="7.5" r="1.2" fill="currentColor"/><rect x="11" y="10" width="2" height="7" rx="1" fill="currentColor"/></svg>
            </button>
          </label>
          <select id="contract">
            <option>Alle</option><option>Fulltime</option><option>Parttime</option>
          </select>

          <label class="label-row">
            <span>Urgentie</span>
            <button type="button" class="info-btn" data-info="urgentie" aria-label="Info urgentie">
              <svg viewBox="0 0 24 24" class="info-icon"><circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/><circle cx="12" cy="7.5" r="1.2" fill="currentColor"/><rect x="11" y="10" width="2" height="7" rx="1" fill="currentColor"/></svg>
            </button>
          </label>
          <select id="urgentie">
            <option>Alle</option><option>Laag</option><option>Normaal</option><option>Hoog (binnen 4 weken)</option>
          </select>

          <label class="label-row">
            <span>Reiskostenvergoeding</span>
            <button type="button" class="info-btn" data-info="reiskosten" aria-label="Info reiskostenvergoeding">
              <svg viewBox="0 0 24 24" class="info-icon"><circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/><circle cx="12" cy="7.5" r="1.2" fill="currentColor"/><rect x="11" y="10" width="2" height="7" rx="1" fill="currentColor"/></svg>
            </button>
          </label>
          <select id="reiskosten">
            <option>Alle</option><option>NS Business Card</option><option>OV 100%</option><option>€0,21/km</option><option>€0,23/km</option><option>Leaseauto</option>
          </select>

          <div class="btn-row">
            <button type="submit">Bereken matches</button>
            <button type="button" id="btnReset" class="button">Reset</button>
          </div>
        </form>
      </div>

      <!-- Scrollende resultaten rechts -->
      <div class="panel results">
        <div id="results" class="list"></div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" hidden>
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal__header">
        <h2 id="modalTitle">Meer info</h2>
        <button class="modal__close" title="Sluiten" data-close>×</button>
      </div>
      <div id="modalBody" class="modal__body"></div>
      <div class="modal__footer">
        <button class="modal__close" data-close>Sluiten</button>
      </div>
    </div>
  </div>

  <script>
    const API = "/match";
    const resultsEl = document.getElementById("results");
    const form = document.getElementById("matchForm");
    const btnReset = document.getElementById("btnReset");
    const modal = document.getElementById("modal");
    const modalBody = document.getElementById("modalBody");
    const fmt = s => String(s||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");

    function openModal(html){ modalBody.innerHTML = html; modal.hidden = false; document.body.classList.add("no-scroll"); }
    function closeModal(){ modal.hidden = true; modalBody.innerHTML = ""; document.body.classList.remove("no-scroll"); }
    modal.addEventListener("click", (e)=>{ if (e.target.dataset.close !== undefined || e.target.classList.contains("modal__backdrop")) closeModal(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape" && !modal.hidden) closeModal(); });

    // Wegingen (UI info)
    const filterInfo = {
      functie:   { weight: 30, reason: "Functie bepaalt of de vaardigheden aansluiten. Daarom weegt dit het zwaarst." },
      locatie:   { weight: 20, reason: "Locatie is belangrijk voor reistijd/beschikbaarheid." },
      uren:      { weight: 20, reason: "Uren bepalen of de contractomvang matcht." },
      sector:    { weight: 10, reason: "Sector geeft domeinkennis/context." },
      contract:  { weight: 10, reason: "Gewenst contract (fulltime/parttime) moet aansluiten." },
      urgentie:  { weight: 5,  reason: "Urgentie helpt prioriteren, maar is niet doorslaggevend." },
      reiskosten:{ weight: 5,  reason: "Reiskostenvergoeding is prettig, maar weegt het minst." }
    };

    document.querySelectorAll(".info-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const key = btn.dataset.info;
        const info = filterInfo[key];
        openModal(`<h3 style="margin:.25rem 0 .5rem">Informatie over filter: ${key}</h3>
          <p><strong>Weging:</strong> ${info.weight}</p>
          <p>${info.reason}</p>`);
      });
    });

    function render(matches){
      if (!matches.length){
        // Leeg-staat als card, zodat layout/hoogte gelijk blijft
        resultsEl.innerHTML = `
          <div class="card empty-state">
            <div>
              <div class="empty-title">Geen resultaten</div>
              <div class="empty-text">Pas de filters links aan en klik op “Bereken matches”.</div>
            </div>
          </div>
        `;
        return;
      }
      resultsEl.innerHTML = matches.map(m=>`
        <div class="card">
          <div class="title">
            <div>
              <div class="job-title">${fmt(m.title)}</div>
              <div class="meta">${fmt(m.company)} • ${fmt(m.locatie)} • ${fmt(m.uren)}u • ${fmt(m.functie)} • ${fmt(m.sector)} • ${fmt(m.contractType)}</div>
            </div>
            <div class="badge">${m.score}% match</div>
          </div>

          <div class="why">
            <strong>Waarom deze score:</strong>
            <ul>${m.why.map(w=>`<li>${fmt(w)}</li>`).join("")}</ul>
          </div>

          <div class="progress"><div class="bar" style="width:${m.score}%"></div></div>

          <div class="actions">
            <button class="secondary" data-id="${m.id}" data-action="info">Meer info</button>
          </div>
        </div>
      `).join("");

      // “Meer info”
      resultsEl.querySelectorAll('[data-action="info"]').forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = Number(btn.dataset.id);
          const v = matches.find(x => x.id === id);
          const d = v.details || {};
          const contacts = (d.contacts||[]).map(c=>`<li>${fmt(c.name)} — <a href="mailto:${fmt(c.email)}">${fmt(c.email)}</a></li>`).join("");
          openModal(`
            <div class="detail-grid">
              <div><h3>Vacature</h3>
                <p><strong>${fmt(v.title)}</strong> bij <strong>${fmt(v.company)}</strong></p>
                <p>${fmt(v.functie)} • ${fmt(v.locatie)} • ${fmt(v.uren)} uur • ${fmt(v.sector)}</p>
                <p><strong>Contract:</strong> ${fmt(d.contractType||"-")}</p>
                <p><strong>Salaris:</strong> ${fmt(d.salary||"-")}</p>
                <p><strong>Urgentie:</strong> ${fmt(d.urgency||"-")}</p>
              </div>
              <div><h3>Bedrijfsfilosofie</h3><p>${fmt(d.philosophy||"—")}</p></div>
              <div><h3>Primaire arbeidsvoorwaarden</h3><ul>${(d.primaryBenefits||[]).map(b=>`<li>${fmt(b)}</li>`).join("") || "<li>—</li>"}</ul></div>
              <div><h3>Secundaire arbeidsvoorwaarden</h3><ul>${(d.secondaryBenefits||[]).map(b=>`<li>${fmt(b)}</li>`).join("") || "<li>—</li>"}</ul></div>
              <div><h3>Reiskostenvergoeding</h3><p>${fmt(d.travelAllowance||"—")}</p></div>
              <div><h3>Contactpersonen</h3><ul>${contacts || "<li>—</li>"}</ul></div>
            </div>
          `);
        });
      });
    }

    async function fetchMatches(payload){
      const res = await fetch("/match", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      render(data.matches);
    }

    form.addEventListener("submit", e=>{
      e.preventDefault();
      fetchMatches({
        functie: document.getElementById("functie").value,
        locatie: document.getElementById("locatie").value,
        uren: document.getElementById("uren").value,
        sector: document.getElementById("sector").value,
        contract: document.getElementById("contract").value,
        urgentie: document.getElementById("urgentie").value,
        reiskosten: document.getElementById("reiskosten").value
      });
    });

    // Reset toont nu de lege card i.p.v. volledig leeg maken
    btnReset.addEventListener("click", ()=> render([]));

    // Init met defaults
    window.addEventListener("DOMContentLoaded", ()=>{
      fetchMatches({
        functie: document.getElementById("functie").value,
        locatie: document.getElementById("locatie").value,
        uren: document.getElementById("uren").value,
        sector: document.getElementById("sector").value,
        contract: document.getElementById("contract").value,
        urgentie: document.getElementById("urgentie").value,
        reiskosten: document.getElementById("reiskosten").value
      });
    });
  </script>
</body>
</html>
